<!DOCTYPE html>
<html>
<head>
    <title>ブロック崩しゲーム</title>
    <style>canvas { border: 1px solid #000; }</style>
</head>
<body>
<canvas id="gameCanvas" width="600" height="400"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let blocks = [];
let ball = { x: 300, y: 200, radius: 10, dx: 4, dy: -4 };
let paddle = { x: 250, y: 370, width: 100, height: 10 };
let score = 0;
let lives = 3;

// Initialize blocks
function initBlocks() {
    const rows = 3;
    const cols = 6;
    const blockWidth = 75;
    const blockHeight = 20;
    const offsetX = 50;
    const offsetY = 30;
    
    for (let c = 0; c < cols; c++) {
        blocks[c] = [];
        for (let r = 0; r < rows; r++) {
            blocks[c][r] = { x: offsetX + c*blockWidth, y: offsetY + r*blockHeight, status: 1 };
        }
    }
}

// Draw blocks
function drawBlocks() {
    for (let c = 0; c < blocks.length; c++) {
        for (let r = 0; r < blocks[c].length; r++) {
            if (blocks[c][r].status === 1) {
                let b = blocks[c][r];
                ctx.beginPath();
                ctx.rect(b.x, b.y, 75, 20);
                ctx.fillStyle = '#0095DD';
                ctx.fill();
                ctx.closePath();
            }
        }
    }
}

// Draw ball
function drawBall() {
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI*2);
    ctx.fillStyle = '#0095DD';
    ctx.fill();
    ctx.closePath();
}

// Draw paddle
function drawPaddle() {
    ctx.beginPath();
    ctx.rect(paddle.x, paddle.y, paddle.width, paddle.height);
    ctx.fillStyle = '#0095DD';
    ctx.fill();
    ctx.closePath();
}

// Update game objects
function update() {
    // Ball movement
    ball.x += ball.dx;
    ball.y += ball.dy;

    // Wall collision
    if (ball.x + ball.dx > canvas.width - ball.radius || ball.x + ball.dx < ball.radius) {
        ball.dx *= -1;
    }
    if (ball.y + ball.dy < ball.radius) {
        ball.dy *= -1;
    }

    // Paddle collision
    if (ball.y + ball.radius > paddle.y && ball.x > paddle.x && ball.x < paddle.x + paddle.width) {
        ball.dy *= -1;
        // Adjust direction based on where it hits the paddle
        let center = paddle.x + paddle.width/2;
        let diff = ball.x - center;
        ball.dx = diff * 2;
    }

    // Block collision
    for (let c = 0; c < blocks.length; c++) {
        for (let r = 0; r < blocks[c].length; r++) {
            let b = blocks[c][r];
            if (b.status === 1) {
                if (ball.x > b.x && ball.x < b.x + 75 && ball.y > b.y && ball.y < b.y + 20) {
                    ball.dy *= -1;
                    b.status = 0;
                    score++;
                }
            }
        }
    }

    // Life check
    if (ball.y + ball.radius > canvas.height) {
        lives--;
        resetBall();
    }
}

// Reset ball position
function resetBall() {
    ball.x = canvas.width/2;
    ball.y = canvas.height/2;
    ball.dx = 4;
    ball.dy = -4;
}

// Game over check
function checkGameOver() {
    if (lives === 0) {
        alert('ゲームオーバー!');
        location.reload();
    }
}

// Check for win
function checkWin() {
    for (let c = 0; c < blocks.length; c++) {
        for (let r = 0; r < blocks[c].length; r++) {
            if (blocks[c][r].status === 1) {
                return;
            }
        }
    }
    alert('クリア!');
    location.reload();
}

// Main game loop
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawBlocks();
    drawBall();
    drawPaddle();
    update();
    checkGameOver();
    checkWin();
    requestAnimationFrame(draw);
}

// Key controls
document.addEventListener('keydown', function(e) {
    if (e.key === 'ArrowLeft' && paddle.x > 0) {
        paddle.x -= 15;
    } else if (e.key === 'ArrowRight' && paddle.x + paddle.width < canvas.width) {
        paddle.x += 15;
    }
});

initBlocks();
draw();
</script>
</body>
</html>